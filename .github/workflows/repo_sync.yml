name: RepoSync

on:
  schedule:
    - cron: "3 3 * * *"   # UTC
  workflow_dispatch:       # Allow manual trigger from UI

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout _manage repository
        uses: actions/checkout@v4
        with:
          repository: phan2410/_manage
          token: ${{ secrets.__RepoSync }}

      - name: Configure Git credentials
        run: |
          git config --global credential.helper cache
          printf "protocol=https\nhost=github.com\nusername=x-access-token\npassword=${{ secrets.__RepoSync }}\n\n" | git credential approve

      - name: Synchronize repositories
        working-directory: ./scripts
        run: |
          chmod +x sync-repos.sh
          ./sync-repos.sh
